<div class="timeline-sidebar">
  <h3>Outbreak Timeline</h3>
  <div id="timeline-entries">
    <p>No events yet...</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get current chapter from URL
  const currentChapter = window.location.pathname.split('/').pop().replace('.html', '') || 'index';
  
  fetch('timeline.yml')
    .then(response => response.text())
    .then(yamlText => {
      const allEvents = jsyaml.load(yamlText);
      const container = document.getElementById('timeline-entries');
      
      // Filter events that should be visible by now
      const visibleEvents = allEvents.filter(event => {
        return event.chapter && event.chapter <= currentChapter;
      });

      if (visibleEvents.length > 0) {
        let html = '<ul>';
        visibleEvents.forEach(item => {
          html += `<li>
            <strong>${item.date}</strong>: ${item.event}
            ${item.page ? `<span class="page-num">(p. ${item.page})</span>` : ''}
          </li>`;
        });
        html += '</ul>';
        container.innerHTML = html;
      }
    });
});
</script>