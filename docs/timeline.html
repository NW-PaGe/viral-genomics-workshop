<div class="timeline-sidebar">
  <h3>Outbreak Timeline</h3>
  <div id="timeline-entries">
    <p class="timeline-loading">Loading events...</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async function() {
  const container = document.getElementById('timeline-entries');
  
  try {
    // Debugging: Verify file path
    console.log("Attempting to load timeline.yml...");
    
    const response = await fetch('timeline.yml');
    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    
    const yamlText = await response.text();
    console.log("YAML content received:", yamlText);
    
    // Debugging: Test YAML parsing
    const data = jsyaml.load(yamlText);
    console.log("Parsed YAML data:", data);
    
    if (!data?.events) throw new Error("YAML missing 'events' array");
    
    // Get current page identifier
    const currentPage = window.location.pathname
      .split('/')
      .pop()
      ?.replace('.html', '')
      ?.replace('index', '') || 'intro';
    
    console.log("Current page:", currentPage);
    
    // Filter and display events
    const visibleEvents = data.events.filter(event => 
      currentPage.includes(event.showAfter.toLowerCase())
    );
    
    console.log("Events to display:", visibleEvents);
    
    if (visibleEvents.length > 0) {
      let html = '<ul class="timeline-list">';
      visibleEvents.forEach(event => {
        html += `
          <li class="timeline-item">
            <span class="timeline-date">${event.date}:</span>
            <span class="timeline-text">${event.text}</span>
          </li>`;
      });
      container.innerHTML = html + '</ul>';
    } else {
      container.innerHTML = '<p class="timeline-empty">More events coming soon...</p>';
    }
    
  } catch (error) {
    console.error("Timeline failed:", error);
    container.innerHTML = `
      <div class="timeline-error">
        <p>Timeline unavailable</p>
        <button onclick="location.reload()">Retry</button>
        <div class="debug-hint">${error.message}</div>
      </div>`;
  }
});
</script>

<style>
.timeline-sidebar {
  position: fixed;
  right: 20px;
  top: 200px;
  width: 200px;
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  z-index: 100;
}

.timeline-list {
  padding-left: 5px;
  list-style: none;
}

.timeline-item {
  margin-bottom: 12px;
  padding-left: 10px;
  border-left: 3px solid #4CAF50;
}

.timeline-date {
  font-weight: bold;
  display: block;
  color: #2c3e50;
}

.timeline-text {
  display: block;
  margin-top: 2px;
}

.timeline-error {
  color: #d32f2f;
  font-size: 0.9em;
}

.debug-hint {
  font-size: 0.8em;
  color: #666;
  margin-top: 5px;
}

button {
  background: #4CAF50;
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 4px;
  margin-top: 8px;
  cursor: pointer;
}
</style>